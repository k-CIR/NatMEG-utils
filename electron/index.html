<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NatMEG-BIDSifier</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f8f8f8;
            color: #000000;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar Navigation */
        .sidebar {
            width: 220px;
            background: #860052;
            color: white;
            display: flex;
            flex-direction: column;
        }
        
        .app-title {
            padding: 20px;
            font-size: 18px;
            font-weight: 700;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .nav-items {
            flex: 1;
            padding: 10px 0;
        }
        
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.2s;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .nav-item.active {
            background: rgba(255,255,255,0.2);
            border-left-color: #98C9A3;
            font-weight: 600;
        }
        
        .nav-item.completed {
            opacity: 0.8;
        }
        
        .nav-item.completed .step-number {
            background: #98C9A3;
            color: #000;
        }
        
        .nav-item .step-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            text-align: center;
            line-height: 28px;
            font-size: 13px;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .nav-item.active .step-number {
            background: #98C9A3;
            color: #000;
        }
        
        .nav-item .step-label {
            flex: 1;
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .content-view {
            display: none;
            flex: 1;
            overflow: auto;
            padding: 30px;
        }
        
        .content-view.active {
            display: flex;
            flex-direction: column;
        }
        
        /* Config Editor */
        .config-editor {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #860052;
        }
        
        .config-header h2 {
            color: #860052;
            font-size: 24px;
        }
        
        .config-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: #98C9A3;
            color: #000;
        }
        
        .btn-primary:hover {
            background: #7ab88a;
        }
        
        .btn-secondary {
            background: #860052;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #660040;
        }
        
        .btn:disabled {
            background: #d0d0d0;
            color: #808080;
            cursor: not-allowed;
        }
        
        .config-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-section {
            grid-column: span 2;
            margin-top: 20px;
        }
        
        .form-section h3 {
            color: #860052;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: 600;
            font-size: 13px;
            color: #555;
        }
        
        .form-group input,
        .form-group textarea {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #860052;
        }
        
        .form-group textarea {
            min-height: 60px;
            resize: vertical;
        }
        
        /* Run View */
        .run-view {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .run-status {
            text-align: center;
            padding: 40px;
        }
        
        .run-status.ready {
            color: #555;
        }
        
        .run-status.running {
            color: #860052;
        }
        
        .run-status.success {
            color: #98C9A3;
        }
        
        .run-status.error {
            color: #ff0000;
        }
        
        .run-button {
            font-size: 18px;
            padding: 15px 40px;
            margin-top: 20px;
        }
        
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            padding: 20px;
            border-radius: 8px;
            height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        
        .console-output .line {
            margin: 2px 0;
        }
        
        .console-output .error {
            color: #ff6b6b;
        }
        
        .console-output .success {
            color: #98C9A3;
        }
        
        .console-output .warning {
            color: #ffd966;
        }
        
        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #98C9A3 0%, #7ab88a 100%);
            width: 0;
            transition: width 0.3s ease;
        }
        
        /* Info boxes */
        .info-box {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .info-box.warning {
            background: #fff3cd;
            border-left: 4px solid #ffd966;
        }
        
        .info-box ul {
            margin: 10px 0 0 0;
            color: #555;
        }
        
        /* Step labels */
        .step-description {
            color: #666;
            margin-bottom: 30px;
        }
        
        /* Button icon */
        .btn-icon {
            padding: 8px 15px;
            background: #860052;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .btn-icon:hover {
            background: #660040;
        }
        
        /* Table View Container */
        #table-view-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-not-run {
            background: #e0e0e0;
            color: #666;
        }
        
        .status-running {
            background: #ffd966;
            color: #000;
        }
        
        .status-completed {
            background: #98C9A3;
            color: #000;
        }
        
        .status-error {
            background: #ffb3b3;
            color: #860052;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="app-title">NatMEG-BIDSifier</div>
            <div class="nav-items">
                <div class="nav-item active" data-view="config" data-step="1">
                    <span class="step-number">1</span>
                    <span class="step-label">Configuration</span>
                </div>
                <div class="nav-item" data-view="analyse" data-step="2">
                    <span class="step-number">2</span>
                    <span class="step-label">Analyse Data</span>
                </div>
                <div class="nav-item" data-view="editor" data-step="3">
                    <span class="step-number">3</span>
                    <span class="step-label">Editor</span>
                </div>
                <div class="nav-item" data-view="execute" data-step="4">
                    <span class="step-number">4</span>
                    <span class="step-label">Execute</span>
                </div>
                <div class="nav-item" data-view="report" data-step="5">
                    <span class="step-number">5</span>
                    <span class="step-label">Report</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Step 1: Configuration -->
            <div class="content-view active" id="config">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <h1 style="margin-bottom: 5px;">Configuration</h1>
                        <p style="color: #666; margin: 0;">Configure essential settings for BIDS conversion</p>
                    </div>
                    <button class="btn btn-secondary" id="loadConfigBtn">üìÇ Load Config</button>
                </div>
                
                <div class="config-form" id="configForm">
                    <div class="form-section">
                        <h3>Project Settings</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Project Name *</label>
                                <input type="text" id="config_project_name" required>
                            </div>
                            <div class="form-group">
                                <label>CIR ID</label>
                                <input type="text" id="config_cir_id">
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Tasks * <small style="color: #666; font-weight: normal;">(comma-separated)</small></label>
                            <input type="text" id="config_tasks" required placeholder="RestingState, TaskA, TaskB">
                            <small style="color: #666; font-size: 12px;">List of experimental tasks in your study</small>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Paths</h3>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Root Path *</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" id="config_root_path" required placeholder="/neuro/data/local" style="flex: 1;">
                                    <button type="button" onclick="browseDirectory('config_root_path')" style="padding: 8px 16px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">Browse...</button>
                                </div>
                                <small style="color: #666; font-size: 12px;">Base directory for all project data.</small>
                            </div>
                            <div class="form-group">
                                <label>Raw Data Path *</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" id="config_raw_path" required style="flex: 1;">
                                    <button type="button" onclick="browseDirectory('config_raw_path')" style="padding: 8px 16px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">Browse...</button>
                                </div>
                                <small style="color: #666; font-size: 12px;">Auto-updates unless manually edited</small>
                            </div>
                            <div class="form-group">
                                <label>BIDS Output Path *</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" id="config_bids_path" required style="flex: 1;">
                                    <button type="button" onclick="browseDirectory('config_bids_path')" style="padding: 8px 16px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">Browse...</button>
                                </div>
                                <small style="color: #666; font-size: 12px;">Auto-updates unless manually edited</small>
                            </div>
                            <div class="form-group">
                                <label>Calibration File Path *</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" id="config_calibration_path" required style="flex: 1;">
                                    <button type="button" onclick="browseFile('config_calibration_path')" style="padding: 8px 16px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">Browse...</button>
                                </div>
                                <small style="color: #666; font-size: 12px;">Auto-updates unless manually edited</small>
                            </div>
                            <div class="form-group">
                                <label>Crosstalk File Path *</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" id="config_crosstalk_path" required style="flex: 1;">
                                    <button type="button" onclick="browseFile('config_crosstalk_path')" style="padding: 8px 16px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;">Browse...</button>
                                </div>
                                <small style="color: #666; font-size: 12px;">Auto-updates unless manually edited</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>BIDS Dataset Description</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Dataset Name</label>
                                <input type="text" id="config_dataset_name" placeholder="My MEG Study">
                            </div>
                            <div class="form-group">
                                <label>BIDS Version</label>
                                <input type="text" id="config_bids_version" value="1.7.0">
                            </div>
                            <div class="form-group">
                                <label>Dataset Type</label>
                                <select id="config_dataset_type">
                                    <option value="raw">raw</option>
                                    <option value="derivative">derivative</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>License</label>
                                <input type="text" id="config_license" placeholder="CC0, CC-BY-4.0, etc.">
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Authors (comma-separated)</label>
                                <input type="text" id="config_authors" placeholder="John Doe, Jane Smith">
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Acknowledgements</label>
                                <textarea id="config_acknowledgements" placeholder="Acknowledgements..." rows="2"></textarea>
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>How to Acknowledge</label>
                                <textarea id="config_how_to_acknowledge" placeholder="Please cite..." rows="2"></textarea>
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Funding (comma-separated)</label>
                                <input type="text" id="config_funding" placeholder="Grant 123456, Foundation XYZ">
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Ethics Approvals (comma-separated)</label>
                                <input type="text" id="config_ethics_approvals" placeholder="IRB-2024-001">
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>References and Links (comma-separated URLs)</label>
                                <input type="text" id="config_references_links" placeholder="https://example.com/study">
                            </div>
                            <div class="form-group">
                                <label>Dataset DOI</label>
                                <input type="text" id="config_dataset_doi" placeholder="doi:10.1234/example">
                            </div>
                            <div class="form-group">
                                <label>Code URL</label>
                                <input type="text" id="config_code_url" value="https://mne.tools/mne-bids/">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Conversion Settings</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Conversion Table File</label>
                                <input type="text" id="config_conversion_file" value="bids_conversion.tsv">
                            </div>
                            <div class="form-group">
                                <label>Overwrite Existing</label>
                                <select id="config_overwrite">
                                    <option value="false">No</option>
                                    <option value="true">Yes</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-secondary" id="saveConfigBtn">üíæ Save Config</button>
                    <button class="btn btn-primary" id="nextToAnalyseBtn">Next: Analyse ‚Üí</button>
                </div>
            </div>
            
            <!-- Step 2: Analyse Data -->
            <div class="content-view" id="analyse">
                <h1>Analyse Data Structure</h1>
                <p style="color: #666; margin-bottom: 30px;">Generate conversion table without executing conversion</p>
                
                <div style="background: #f8f8f8; padding: 20px; border-radius: 8px; border-left: 4px solid #98C9A3; margin-bottom: 30px;">
                    <strong style="color: #000;">What happens in this step:</strong>
                    <ul style="margin: 10px 0 0 0; color: #555;">
                        <li>Scans raw data directory structure</li>
                        <li>Generates bids_conversion.tsv with file mapping</li>
                        <li>No files are converted or modified</li>
                        <li>Results can be edited in next step</li>
                    </ul>
                </div>

                <div style="text-align: center; margin: 40px 0;">
                    <button class="btn btn-primary" id="runAnalyseBtn" style="font-size: 16px; padding: 15px 40px;">Analyse Data Structure</button>
                </div>

                <div class="progress-container" id="analyseProgressContainer" style="display: none;">
                    <div class="progress-bar" id="analyseProgressBar"></div>
                </div>
                <div id="analyseProgressText" style="text-align: center; margin: 10px 0; color: #666; display: none;">Ready to analyse</div>

                <div class="console-output" id="analyseConsole" style="display: none;"></div>

                <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: space-between;">
                    <button class="btn btn-secondary" id="backToConfigBtn">‚Üê Back</button>
                    <button class="btn btn-primary" id="nextToEditorBtn" disabled>Next: Editor ‚Üí</button>
                </div>
            </div>
            
            <!-- Step 3: Editor -->
            <div class="content-view" id="editor">
                <h1>Edit Conversion Table</h1>
                <p style="color: #666; margin-bottom: 20px;">Review and modify BIDS conversion mappings</p>
                
                <div style="background: #f8f8f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #555;">
                    <strong style="color: #000;">Instructions:</strong> Edit the table below to correct any conversion mappings. Changes will be saved when you click Save. Only entries with status "run" will be processed in the Execute step.
                </div>

                <!-- Batch Actions -->
                <div id="batchActionsDiv" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 6px; background-color: #f9f9f9; display: none;">
                    <h3 style="margin: 0 0 10px 0; color: #860052; font-size: 16px;">Batch Actions</h3>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span id="selectedCount" style="font-weight: bold; color: #333;">0 rows selected</span>
                        <select id="batchStatusSelect" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                            <option value="">-- Change Status --</option>
                            <option value="run">run</option>
                            <option value="check">check</option>
                            <option value="processed">processed</option>
                            <option value="skip">skip</option>
                        </select>
                        <button id="applyBatchStatusBtn" style="padding: 8px 16px; background-color: #860052; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;">
                            Apply to Selected
                        </button>
                    </div>
                </div>

                <!-- Controls -->
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                    <button class="btn btn-secondary" id="loadTableBtn" style="padding: 8px 16px;">
                        üìÇ Load Table
                    </button>
                    <button class="btn btn-secondary" id="reloadTableBtn" style="padding: 8px 16px;" disabled title="Reload conversion table from disk">
                        üîÑ Reload
                    </button>
                    <button class="btn btn-primary" id="saveTableBtn" disabled style="padding: 8px 16px;">
                        üíæ Save Changes
                    </button>
                    <input type="text" id="editorSearchInput" placeholder="üîç Search all fields..." 
                           style="flex: 1; min-width: 200px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                    <div style="color: #666; font-size: 14px;" id="editorRowCount">No data loaded</div>
                </div>

                <!-- Filters -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <select id="statusFilterSelect" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="">All Status</option>
                        <option value="run">Run</option>
                        <option value="processed">Processed</option>
                        <option value="check">Check</option>
                        <option value="skip">Skip</option>
                    </select>
                    <select id="subjectFilterSelect" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="">All Subjects</option>
                    </select>
                    <select id="sessionFilterSelect" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="">All Sessions</option>
                    </select>
                    <select id="taskFilterSelect" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="">All Tasks</option>
                    </select>
                    <select id="acquisitionFilterSelect" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="">All Acquisitions</option>
                    </select>
                    <button class="btn btn-secondary" id="clearFiltersBtn" style="padding: 8px 16px; font-size: 14px;">
                        Clear Filters
                    </button>
                </div>

                <!-- Loading indicator -->
                <div id="editorLoading" style="text-align: center; padding: 40px; color: #666; display: none;">
                    Loading conversion table...
                </div>

                <!-- Error message -->
                <div id="editorError" style="color: #d32f2f; padding: 15px; background: #ffebee; border-radius: 6px; margin-bottom: 20px; display: none;"></div>

                <!-- Table container -->
                <div style="overflow-x: auto; background: white; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; max-height: calc(100vh - 480px);">
                    <table id="conversionTable" style="width: 100%; border-collapse: collapse; display: none;">
                        <thead style="position: sticky; top: 0; background: #860052; color: white; z-index: 10;">
                            <tr>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd; width: 40px;">
                                    <input type="checkbox" id="selectAllCheckbox" style="cursor: pointer;" title="Select/Deselect All">
                                </th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 100px; cursor: pointer;" data-sort="status">
                                    Status <span style="font-size: 10px;">‚ñº</span>
                                </th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 100px; cursor: pointer;" data-sort="participant_to">
                                    Subject <span style="font-size: 10px;">‚ñº</span>
                                </th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 100px; cursor: pointer;" data-sort="session_to">
                                    Session <span style="font-size: 10px;">‚ñº</span>
                                </th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 150px; cursor: pointer;" data-sort="task">
                                    Task <span style="font-size: 10px;">‚ñº</span>
                                </th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 100px; cursor: pointer;" data-sort="acquisition">
                                    Acquisition <span style="font-size: 10px;">‚ñº</span>
                                </th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 80px;">Run</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 80px;">Split</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 100px;">Processing</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 120px;">Description</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 200px;">Raw File</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd; min-width: 200px;">BIDS File</th>
                            </tr>
                        </thead>
                        <tbody id="conversionTableBody">
                            <!-- Rows populated dynamically -->
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: space-between;">
                    <button class="btn btn-secondary" id="backToAnalyseBtn">‚Üê Back</button>
                    <button class="btn btn-primary" id="nextToExecuteBtn">Next: Execute ‚Üí</button>
                </div>
            </div>
            
            <!-- Step 4: Execute -->
            <div class="content-view" id="execute">
                <h1>Execute BIDS Conversion</h1>
                <p style="color: #666; margin-bottom: 30px;">Run the actual file conversion based on edited table</p>

                <div style="background: #fff3cd; padding: 20px; border-radius: 8px; border-left: 4px solid #ffd966; margin-bottom: 30px;">
                    <strong style="color: #000;">‚ö†Ô∏è Warning:</strong>
                    <p style="margin: 10px 0 0 0; color: #555;">This step will convert and organize files according to the BIDS specification. Make sure you have reviewed the conversion table in the previous step.</p>
                </div>

                <div style="text-align: center; margin: 40px 0;">
                    <button class="btn btn-primary" id="runBidsifyBtn" style="font-size: 16px; padding: 15px 40px;">Start Conversion</button>
                </div>

                <div class="progress-container" id="executeProgressContainer" style="display: none;">
                    <div class="progress-bar" id="executeProgressBar"></div>
                </div>
                <div id="executeProgressText" style="text-align: center; margin: 10px 0; color: #666; display: none;">Ready to execute</div>

                <div class="console-output" id="executeConsole" style="display: none;"></div>

                <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: space-between;">
                    <button class="btn btn-secondary" id="backToEditorBtn">‚Üê Back</button>
                    <button class="btn btn-primary" id="nextToReportBtn" disabled>Next: Report ‚Üí</button>
                </div>
            </div>
            
            <!-- Step 5: Report -->
            <div class="content-view" id="report">
                <h1>Conversion Report</h1>
                <p style="color: #666; margin-bottom: 30px;">Summary of BIDS conversion results and quality metrics</p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 36px; font-weight: bold; color: #98C9A3;" id="stat-files-converted">0</div>
                        <div style="color: #666; margin-top: 10px;">Files Converted</div>
                    </div>
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 36px; font-weight: bold; color: #860052;" id="stat-subjects">0</div>
                        <div style="color: #666; margin-top: 10px;">Subjects</div>
                    </div>
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 36px; font-weight: bold; color: #860052;" id="stat-sessions">0</div>
                        <div style="color: #666; margin-top: 10px;">Sessions</div>
                    </div>
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
                        <div style="font-size: 36px; font-weight: bold; color: #ff6b6b;" id="stat-errors">0</div>
                        <div style="color: #666; margin-top: 10px;">Errors</div>
                    </div>
                </div>

                <div id="report-details" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h3 style="color: #860052; margin-bottom: 15px;">Conversion Details</h3>
                    <p style="color: #666;">Run the conversion to see detailed results here.</p>
                </div>

                <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: space-between;">
                    <button class="btn btn-secondary" id="backToExecuteBtn">‚Üê Back to Execute</button>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" id="startOverBtn">‚Üê Start Over</button>
                        <button class="btn btn-primary" id="exportReportBtn">Export Report</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="app.js"></script>
</body>
</html>
